<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>News Summary</title>

    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-CHXHM9CZKM"
    ></script>

    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-CHXHM9CZKM");
    </script>

    <!-- Favicons -->
    <link href="/img/favicon.png" rel="icon" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <link rel="stylesheet" href="../../../assets/css/translation.css" />
  </head>
  <body>
    <div class="translation-card">
      <h2>✍️ Translation Challenge</h2>
      <p class="subtitle">
        Translate the sentences into French. (Watch your spelling!)
      </p>

      <div id="quiz-area">
        <div class="question-block" id="block-1">
          <span class="english-prompt"
            >Here is a summary of the news from September 4, 2024.
          </span>
          <input
            type="text"
            class="user-input"
            id="q1"
            placeholder="Type here..."
          />
          <div class="feedback-msg" id="msg-1"></div>
        </div>

        <div class="question-block" id="block-2">
          <span class="english-prompt"
            >The report covers heavy rains in Niger,</span
          >
          <input type="text" class="user-input" id="q2" placeholder="..." />
          <div class="feedback-msg" id="msg-2"></div>
        </div>

        <div class="question-block" id="block-3">
          <span class="english-prompt"
            >the arrival of monkeypox (mpox) vaccines in the Democratic Republic
            of Congo,</span
          >
          <input type="text" class="user-input" id="q3" placeholder="..." />
          <div class="feedback-msg" id="msg-3"></div>
        </div>

        <div class="question-block" id="block-4">
          <span class="english-prompt"
            >the British Prime Minister's apology to the victims of the London
            fire that occurred seven years ago,</span
          >
          <input type="text" class="user-input" id="q4" placeholder="..." />
          <div class="feedback-msg" id="msg-4"></div>
        </div>

        <div class="question-block" id="block-5">
          <span class="english-prompt"
            >and the anticipation surrounding the composition of the new
            government in France.</span
          >
          <input type="text" class="user-input" id="q5" placeholder="..." />
          <div class="feedback-msg" id="msg-5"></div>
        </div>
      </div>

      <div class="btn-row">
        <button class="btn-verify" onclick="checkTranslations()">
          Check Answers
        </button>
        <button class="btn-reset" onclick="resetTranslations()">Reset</button>
      </div>
    </div>

    <script>
      // The Answer Key (Supports multiple correct variations separated by | )
      const answerKey = {
        q1: ["Voici le résumé de l’actualité du 4 septembre 2024"],
        q2: ["Le reportage évoque les fortes pluies au Niger, "],
        q3: [
          "l’arrivée de vaccins contre la variole du singe en République démocratique du Congo, ",
        ],
        q4: [
          "les excuses du Premier ministre britannique aux victimes de l’incendie de Londres survenu il y a sept ans,",
        ],
        q5: [
          "ainsi que l’attente concernant la composition du nouveau gouvernement en France.",
        ],
      };

      function checkTranslations() {
        // Loop through each question ID
        for (let i = 1; i <= 10; i++) {
          const inputId = "q" + i;
          const blockId = "block-" + i;
          const msgId = "msg-" + i;

          const inputEl = document.getElementById(inputId);
          const blockEl = document.getElementById(blockId);
          const msgEl = document.getElementById(msgId);

          // Normalize user input: Lowercase, remove extra spaces, remove punctuation at end
          let userVal = inputEl.value.trim().toLowerCase();
          if (userVal.endsWith(".")) userVal = userVal.slice(0, -1); // Remove trailing dot

          // Clean up accents for flexible matching (Optional, but nice to have)
          // For strict mode, remove the next line.
          // userVal = userVal.normalize("NFD").replace(/[\u0300-\u036f]/g, "");

          // Get valid answers for this question
          const validAnswers = answerKey[inputId].map((a) => a.toLowerCase());

          // Check if user input matches ANY valid answer
          // Note: If you removed accent stripping above, ensure inputs match exactly.
          // Here we do a somewhat strict check but allow case insensitivity.

          let isCorrect = false;
          // Check against normalized answers
          for (let ans of validAnswers) {
            if (userVal === ans) isCorrect = true;
          }

          // UI Updates
          if (isCorrect) {
            blockEl.classList.add("correct-block");
            blockEl.classList.remove("wrong-block");
            msgEl.style.display = "block";
            msgEl.style.color = "#27ae60";
            msgEl.innerText = "✅ Correct!";
            inputEl.style.color = "#27ae60";
          } else {
            blockEl.classList.add("wrong-block");
            blockEl.classList.remove("correct-block");
            msgEl.style.display = "block";
            msgEl.style.color = "#c0392b";
            // Show the first valid answer as the correction
            msgEl.innerText = `❌ Correction: "${answerKey[inputId][0]}"`;
            inputEl.style.color = "#c0392b";
          }
        }
      }

      function resetTranslations() {
        for (let i = 1; i <= 10; i++) {
          const inputEl = document.getElementById("q" + i);
          const blockEl = document.getElementById("block-" + i);
          const msgEl = document.getElementById("msg-" + i);

          inputEl.value = "";
          blockEl.classList.remove("correct-block", "wrong-block");
          msgEl.style.display = "none";
          inputEl.style.color = "";
        }
      }

      // Real-time feedback: Turn green immediately if correct
      document.querySelectorAll(".user-input").forEach((input) => {
        input.addEventListener("input", function () {
          const inputId = this.id;
          if (!answerKey[inputId]) return;

          let userVal = this.value.trim().toLowerCase();
          if (userVal.endsWith(".")) userVal = userVal.slice(0, -1);

          const validAnswers = answerKey[inputId].map((a) => a.toLowerCase());

          if (validAnswers.includes(userVal)) {
            this.style.color = "#27ae60";
          } else {
            this.style.color = "";
          }
        });
      });

      // Audio playback for English prompts
      document.querySelectorAll(".question-block").forEach((block) => {
        const prompt = block.querySelector(".english-prompt");
        if (prompt) {
          const num = block.id.replace("block-", "");
          prompt.style.cursor = "pointer";
          prompt.title = "Click to listen";

          prompt.addEventListener("click", () => {
            new Audio(`/media/RFI240904/trans/${num}.mp3`).play();
          });
        }
      });
    </script>
    <script type="module" src="../../../assets/js/steps.js"></script>
  </body>
</html>
