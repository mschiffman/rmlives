<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>French Collocation Web: La Fourchette</title>

    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-CHXHM9CZKM"
    ></script>

    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-CHXHM9CZKM");
    </script>

    <!-- Favicons -->
    <link href="/img/favicon.png" rel="icon" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
    />

    <link rel="stylesheet" href="../../../../assets/css/octopus.css" />
  </head>
  <body>
    <nav class="navbar navbar-dark bg-dark mb-4">
      <div class="container-fluid">
        <span class="navbar-brand mb-0 h1">üá´üá∑ French Collocation Web</span>
      </div>
    </nav>

    <div class="container-fluid px-4">
      <div class="d-flex gap-2 mb-3">
        <a href="collo-cooktop.html" class="btn btn-sm btn-outline-dark"
          >Cooktop</a
        >
        <a href="collo-kettle.html" class="btn btn-sm btn-outline-dark"
          >Kettle</a
        >
        <a href="collo-microwave.html" class="btn btn-sm btn-outline-dark"
          >Microwave</a
        >
        <a href="collo-oven.html" class="btn btn-sm btn-outline-dark">Oven</a>
        <a href="collo-range hood.html" class="btn btn-sm btn-outline-dark"
          >Range hood</a
        >
        <a href="collo-rice cooker.html" class="btn btn-sm btn-outline-dark"
          >Rice cooker</a
        >
        <a href="collo-toaster.html" class="btn btn-sm btn-outline-dark"
          >Toaster</a
        >
        <a href="collo-toaster oven.html" class="btn btn-sm btn-outline-dark"
          >Toaster oven</a
        >
      </div>
      <div class="row">
        <div class="col-lg-9 mb-4">
          <div id="graph-container"></div>
          <div id="tooltip" class="tooltip"></div>
        </div>

        <div class="col-lg-3">
          <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
              Selection Details
            </div>
            <div class="card-body" id="info-panel">
              <h5 class="card-title text-muted">Hover or Click a Node</h5>
              <p class="card-text">
                Select a word in the web to see its English translation and
                details here.
              </p>
            </div>
          </div>

          <div class="card mt-3 shadow-sm">
            <div class="card-header">Legend</div>
            <ul class="list-group list-group-flush">
              <li class="list-group-item">
                <span class="legend-dot" style="background: #e63946"></span>
                Verbs (Actions)
              </li>
              <li class="list-group-item">
                <span class="legend-dot" style="background: #457b9d"></span>
                Adjectives (Description)
              </li>
              <li class="list-group-item">
                <span class="legend-dot" style="background: #9b5de5"></span>
                Idioms (Expressions)
              </li>
              <li class="list-group-item">
                <span class="legend-dot" style="background: #2a9d8f"></span>
                Associations (Nouns)
              </li>
              <li class="list-group-item">
                <span class="legend-dot" style="background: #d32fcc"></span>
                Parts
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <script src="https://d3js.org/d3.v7.min.js"></script>

    <script>
      // --- 1. DATA PREPARATION ---
      // Embedded JSON data for "Le Couteau"
      const dataset = {
        nodes: [
          // Center
          {
            id: "La Bouilloire",
            group: "center",
            radius: 30,
            translation: "The kettle",
            example:
              "Je mets de l'eau dans la bouilloire.<br><em>I'm putting water in the kettle.</em>",
          },

          // Categories
          { id: "Verbes", group: "category", radius: 0 },
          { id: "Adjectifs", group: "category", radius: 0 },
          { id: "Associations", group: "category", radius: 0 },
          { id: "Expressions", group: "category", radius: 0 },
          { id: "Parts", group: "category", radius: 0 },

          // Verbs
          {
            id: "Remplir",
            group: "verb",
            translation: "to fill",
            example:
              "Remplis la bouilloire d'eau.<br><em>Fill the kettle with water.</em>",
          },
          {
            id: "Brancher",
            group: "verb",
            translation: "to plug in",
            example: "Branche la bouilloire.<br><em>Plug in the kettle.</em>",
          },
          {
            id: "Allumer",
            group: "verb",
            translation: "to turn on",
            example: "Allume la bouilloire.<br><em>Turn on the kettle.</em>",
          },
          {
            id: "Faire bouillir",
            group: "verb",
            translation: "to boil",
            example:
              "Je fais bouillir de l'eau.<br><em>I'm boiling water.</em>",
          },
          {
            id: "Verser",
            group: "verb",
            translation: "to pour",
            example:
              "Verse l'eau chaude dans la tasse.<br><em>Pour the hot water into the cup.</em>",
          },
          {
            id: "D√©brancher",
            group: "verb",
            translation: "to unplug",
            example: "D√©branche la bouilloire.<br><em>Unplug the kettle.</em>",
          },
          {
            id: "Nettoyer",
            group: "verb",
            translation: "to clean",
            example:
              "Je nettoie la bouilloire r√©guli√®rement.<br><em>I clean the kettle regularly.</em>",
          },
          {
            id: "D√©tartrer",
            group: "verb",
            translation: "to descale",
            example:
              "Il faut d√©tartrer la bouilloire.<br><em>The kettle needs to be descaled.</em>",
          },
          {
            id: "Vider",
            group: "verb",
            translation: "to empty",
            example:
              "Vide l'eau restante.<br><em>Empty the remaining water.</em>",
          },

          // Adjectives
          {
            id: "Chaude",
            group: "adjective",
            translation: "hot",
            example: "L'eau est chaude.<br><em>The water is hot.</em>",
          },
          {
            id: "Bouillante",
            group: "adjective",
            translation: "boiling",
            example:
              "Attention, l'eau est bouillante !<br><em>Careful, the water is boiling!</em>",
          },
          {
            id: "√âlectrique",
            group: "adjective",
            translation: "electric",
            example:
              "C'est une bouilloire √©lectrique.<br><em>It's an electric kettle.</em>",
          },
          {
            id: "Pleine",
            group: "adjective",
            translation: "full",
            example:
              "La bouilloire est pleine.<br><em>The kettle is full.</em>",
          },
          {
            id: "Vide",
            group: "adjective",
            translation: "empty",
            example: "La bouilloire est vide.<br><em>The kettle is empty.</em>",
          },
          {
            id: "Entartr√©e",
            group: "adjective",
            translation: "scaled up/limescale buildup",
            example:
              "Elle est toute entartr√©e.<br><em>It's all scaled up.</em>",
          },

          // Associations
          {
            id: "Le th√©",
            group: "noun",
            translation: "tea",
            example: "Je me fais un th√©.<br><em>I'm making myself tea.</em>",
          },
          {
            id: "Le caf√©",
            group: "noun",
            translation: "coffee",
            example:
              "Je pr√©pare un caf√© instantan√©.<br><em>I'm making instant coffee.</em>",
          },
          {
            id: "L'infusion",
            group: "noun",
            translation: "herbal tea",
            example:
              "Je bois une infusion le soir.<br><em>I drink herbal tea in the evening.</em>",
          },
          {
            id: "La tisane",
            group: "noun",
            translation: "herbal tea",
            example: "Une tisane √† la camomille.<br><em>A chamomile tea.</em>",
          },
          {
            id: "L'eau chaude",
            group: "noun",
            translation: "hot water",
            example: "J'ai besoin d'eau chaude.<br><em>I need hot water.</em>",
          },
          {
            id: "La tasse",
            group: "noun",
            translation: "cup",
            example:
              "Verse l'eau dans la tasse.<br><em>Pour the water into the cup.</em>",
          },

          // Expressions
          {
            id: "L'eau bout",
            group: "idiom",
            translation: "The water is boiling",
            example:
              "L'eau bout, elle est pr√™te.<br><em>The water is boiling, it's ready.</em>",
          },
          {
            id: "√áa siffle",
            group: "idiom",
            translation: "It's whistling",
            example:
              "√áa siffle, l'eau est pr√™te !<br><em>It's whistling, the water is ready!</em>",
          },
          {
            id: "Elle s'est √©teinte",
            group: "idiom",
            translation: "It turned off (automatically)",
            example:
              "Elle s'est √©teinte toute seule.<br><em>It turned off by itself.</em>",
          },
          {
            id: "Il n'y a plus d'eau",
            group: "idiom",
            translation: "There's no more water",
            example:
              "Il n'y a plus d'eau dans la bouilloire.<br><em>There's no more water in the kettle.</em>",
          },
          {
            id: "Fais chauffer de l'eau",
            group: "idiom",
            translation: "Heat up some water",
            example:
              "Fais chauffer de l'eau pour le th√©.<br><em>Heat up some water for tea.</em>",
          },

          // Parts
          {
            id: "Le bec verseur",
            group: "part",
            translation: "spout",
            example:
              "L'eau sort par le bec verseur.<br><em>The water comes out through the spout.</em>",
          },
          {
            id: "Le couvercle",
            group: "part",
            translation: "lid",
            example:
              "Ouvre le couvercle pour remplir.<br><em>Open the lid to fill.</em>",
          },
          {
            id: "La poign√©e",
            group: "part",
            translation: "handle",
            example:
              "Tiens-la par la poign√©e.<br><em>Hold it by the handle.</em>",
          },
          {
            id: "Le bouton",
            group: "part",
            translation: "button/switch",
            example: "Appuie sur le bouton.<br><em>Press the button.</em>",
          },
          {
            id: "La base",
            group: "part",
            translation: "base",
            example: "Pose-la sur la base.<br><em>Put it on the base.</em>",
          },
          {
            id: "Le filtre",
            group: "part",
            translation: "filter",
            example:
              "Le filtre emp√™che le tartre de sortir.<br><em>The filter keeps the limescale from coming out.</em>",
          },
          {
            id: "Le niveau d'eau",
            group: "part",
            translation: "water level indicator",
            example:
              "Regarde le niveau d'eau.<br><em>Check the water level.</em>",
          },
          {
            id: "Le cordon",
            group: "part",
            translation: "cord",
            example:
              "Le cordon est enroul√© autour de la base.<br><em>The cord is wrapped around the base.</em>",
          },
        ],

        links: [
          // Center Connections
          { source: "La Bouilloire", target: "Verbes" },
          { source: "La Bouilloire", target: "Adjectifs" },
          { source: "La Bouilloire", target: "Associations" },
          { source: "La Bouilloire", target: "Expressions" },
          { source: "La Bouilloire", target: "Parts" },

          // Verbs
          { source: "Verbes", target: "Remplir" },
          { source: "Verbes", target: "Brancher" },
          { source: "Verbes", target: "Allumer" },
          { source: "Verbes", target: "Faire bouillir" },
          { source: "Verbes", target: "Verser" },
          { source: "Verbes", target: "D√©brancher" },
          { source: "Verbes", target: "Nettoyer" },
          { source: "Verbes", target: "D√©tartrer" },
          { source: "Verbes", target: "Vider" },

          // Adjectives
          { source: "Adjectifs", target: "Chaude" },
          { source: "Adjectifs", target: "Bouillante" },
          { source: "Adjectifs", target: "√âlectrique" },
          { source: "Adjectifs", target: "Pleine" },
          { source: "Adjectifs", target: "Vide" },
          { source: "Adjectifs", target: "Entartr√©e" },

          // Associations
          { source: "Associations", target: "Le th√©" },
          { source: "Associations", target: "Le caf√©" },
          { source: "Associations", target: "L'infusion" },
          { source: "Associations", target: "La tisane" },
          { source: "Associations", target: "L'eau chaude" },
          { source: "Associations", target: "La tasse" },

          // Expressions
          { source: "Expressions", target: "L'eau bout" },
          { source: "Expressions", target: "√áa siffle" },
          { source: "Expressions", target: "Elle s'est √©teinte" },
          { source: "Expressions", target: "Il n'y a plus d'eau" },
          { source: "Expressions", target: "Fais chauffer de l'eau" },

          // Parts
          { source: "Parts", target: "Le bec verseur" },
          { source: "Parts", target: "Le couvercle" },
          { source: "Parts", target: "La poign√©e" },
          { source: "Parts", target: "Le bouton" },
          { source: "Parts", target: "La base" },
          { source: "Parts", target: "Le filtre" },
          { source: "Parts", target: "Le niveau d'eau" },
          { source: "Parts", target: "Le cordon" },
        ],
      };
      // --- 2. CONFIGURATION ---
      const width = document.getElementById("graph-container").clientWidth;
      const height = 600;

      // Color Palette
      const colors = {
        center: "#212529", // Dark Grey
        category: "#adb5bd", // Light Grey (connectors)
        verb: "#e63946", // Red
        adjective: "#457b9d", // Blue
        noun: "#2a9d8f", // Teal/Green
        idiom: "#9b5de5", // Purple
        part: "#d32fcc", // Pink
      };

      // --- 3. D3 SETUP ---
      const svg = d3
        .select("#graph-container")
        .append("svg")
        .attr("width", width)
        .attr("height", height)
        .call(
          d3.zoom().on("zoom", (event) => {
            g.attr("transform", event.transform);
          }),
        );

      const g = svg.append("g");

      // Force Simulation
      const simulation = d3
        .forceSimulation(dataset.nodes)
        .force(
          "link",
          d3
            .forceLink(dataset.links)
            .id((d) => d.id)
            .distance(70),
        )
        .force("charge", d3.forceManyBody().strength(-300))
        .force("center", d3.forceCenter(width / 2, height / 2))
        .force(
          "collide",
          d3.forceCollide().radius((d) => (d.radius || 20) + 10),
        );

      // Draw Links
      const link = g
        .append("g")
        .attr("class", "links")
        .selectAll("line")
        .data(dataset.links)
        .enter()
        .append("line")
        .attr("class", "link");

      // Draw Nodes (Circles)
      const node = g
        .append("g")
        .attr("class", "nodes")
        .selectAll("g")
        .data(dataset.nodes)
        .enter()
        .append("g")
        .call(
          d3
            .drag()
            .on("start", dragstarted)
            .on("drag", dragged)
            .on("end", dragended),
        );

      node
        .append("circle")
        .attr("r", (d) => d.radius || 15) // Default radius 15 if not specified
        .attr("fill", (d) => colors[d.group] || "#ccc")
        // Hover Events
        .on("mouseover", function (event, d) {
          // Show Tooltip
          const tooltip = d3.select("#tooltip");
          tooltip.transition().duration(200).style("opacity", 0.9);

          // Content of Tooltip
          let content = `<strong>${d.id}</strong>`;
          if (d.translation) {
            content += `<br/><span style="color:#ccc; font-size:12px">"${d.translation}"</span>`;
          }

          tooltip
            .html(content)
            .style("left", event.pageX + 10 + "px")
            .style("top", event.pageY - 28 + "px");

          // Highlight Node
          d3.select(this).attr("stroke", "#333").attr("stroke-width", 3);
        })
        .on("mouseout", function (d) {
          d3.select("#tooltip").transition().duration(500).style("opacity", 0);
          d3.select(this).attr("stroke", "#fff").attr("stroke-width", 2);
        })
        .on("click", function (event, d) {
          updateInfoPanel(d);

          // Only speak the French word (the ID), not the category names
          if (d.group !== "category") {
            speakWord(d.id);
          }
        });

      // Add Text Labels
      node
        .append("text")
        .attr("dy", (d) => (d.radius || 15) + 15) // Position text below the circle
        .text((d) => (d.group === "category" ? "" : d.id)) // Don't label the category nodes (cleaner look)
        .style("font-size", (d) => (d.group === "center" ? "16px" : "12px"))
        .style("font-weight", (d) =>
          d.group === "center" ? "bold" : "normal",
        );

      // --- 4. SIMULATION UPDATE ---
      simulation.on("tick", () => {
        link
          .attr("x1", (d) => d.source.x)
          .attr("y1", (d) => d.source.y)
          .attr("x2", (d) => d.target.x)
          .attr("y2", (d) => d.target.y);

        node.attr("transform", (d) => `translate(${d.x},${d.y})`);
      });

      // --- 5. DRAG FUNCTIONS ---
      function dragstarted(event, d) {
        if (!event.active) simulation.alphaTarget(0.3).restart();
        d.fx = d.x;
        d.fy = d.y;
      }

      function dragged(event, d) {
        d.fx = event.x;
        d.fy = event.y;
      }

      function dragended(event, d) {
        if (!event.active) simulation.alphaTarget(0);
        d.fx = null;
        d.fy = null;
      }

      // --- 6. INFO PANEL UPDATE ---
      function updateInfoPanel(d) {
        const panel = document.getElementById("info-panel");

        // If a category node (grey dot) is clicked, clear the panel or show instructions
        if (d.group === "category") {
          panel.innerHTML = `<h5 class="card-title text-muted">Select a Word</h5><p class="card-text">Click a colored node to see details.</p>`;
          return;
        }

        // Capitalize the type (e.g., "verb" -> "Verb")
        let typeLabel = d.group.charAt(0).toUpperCase() + d.group.slice(1);

        // Handle missing data gracefully
        let translationText = d.translation ? `"${d.translation}"` : "";

        // THIS IS THE NEW PART: Check for the example sentence
        let exampleHtml = "";
        if (d.example) {
          // Extract the French part (before the <br>) and escape single quotes for the onclick handler
          const frenchPart = d.example.split("<br>")[0].replace(/'/g, "\\'");
          exampleHtml = `
                <div class="alert alert-light border mt-3" style="background-color: #f8f9fa; cursor: pointer;" onclick="speakWord('${frenchPart}')" title="Click to listen">
                    <small class="text-uppercase text-muted" style="font-size: 0.75rem; letter-spacing: 1px;">Context üîä</small>
                    <p class="mb-0 fst-italic text-dark">"${d.example}"</p>
                </div>`;
        } else {
          // Fallback if you haven't added an example yet
          exampleHtml = `
                <div class="alert alert-warning border mt-3 p-2">
                    <small class="text-muted">No example sentence available.</small>
                </div>`;
        }

        // Render the panel
        panel.innerHTML = `
            <h3 class="card-title" style="color:${colors[d.group]}">${d.id}</h3>
            <h6 class="card-subtitle mb-2 text-muted">${typeLabel}</h6>
            <p class="card-text fs-5">${translationText}</p>
            <hr>
            ${exampleHtml}
        `;
      }

      function speakWord(word) {
        // Check if the browser supports speech synthesis
        if ("speechSynthesis" in window) {
          const utterance = new SpeechSynthesisUtterance(word);

          // Set language to French
          utterance.lang = "fr-FR";

          // Optional: Adjust speed (0.5 is slower, 1 is normal)
          utterance.rate = 0.9;

          // Speak!
          window.speechSynthesis.speak(utterance);
        } else {
          console.log("Browser does not support text-to-speech");
        }
      }
    </script>
    <script type="module" src="../../../../assets/js/nav-step.js"></script>
  </body>
</html>
