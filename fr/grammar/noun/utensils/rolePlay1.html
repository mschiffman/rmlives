<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Interactive Dialogue</title>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-CHXHM9CZKM"
    ></script>

    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-CHXHM9CZKM");
    </script>

    <!-- Favicons -->
    <link href="/img/favicon.png" rel="icon" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
    />
    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        background-color: #f0f2f5;
        display: flex;
        justify-content: center;
        padding: 20px;
      }

      .chat-container {
        background: white;
        max-width: 600px;
        width: 100%;
        border-radius: 20px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }

      /* Header / Controls */
      .chat-header {
        background: #2c3e50;
        color: white;
        padding: 15px;
        text-align: center;
      }

      .controls {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 10px;
      }

      .mode-btn {
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.4);
        color: white;
        padding: 5px 15px;
        border-radius: 15px;
        cursor: pointer;
        font-size: 0.85rem;
        transition: all 0.2s;
      }

      .mode-btn.active {
        background: #27ae60;
        border-color: #27ae60;
        font-weight: bold;
      }

      /* The Chat Area */
      .chat-area {
        padding: 20px;
        background-color: #e5ddd5; /* Whatsapp-ish background */
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      /* Message Bubbles */
      .message {
        max-width: 80%;
        padding: 10px 15px;
        border-radius: 15px;
        position: relative;
        cursor: pointer;
        transition: transform 0.1s;
        line-height: 1.4;
      }

      .message:hover {
        transform: scale(1.02);
      }

      .msg-a {
        align-self: flex-start;
        background: white;
        border-bottom-left-radius: 2px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      }

      .msg-b {
        align-self: flex-end;
        background: #dcf8c6; /* Light Green */
        border-bottom-right-radius: 2px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      }

      /* Blur Effect for Roleplay */
      .blur-me {
        color: transparent !important;
        text-shadow: 0 0 8px rgba(0, 0, 0, 0.5);
        user-select: none;
      }

      .speaker-label {
        font-size: 0.7rem;
        color: #999;
        margin-bottom: 4px;
        display: block;
      }

      .audio-icon {
        display: inline-block;
        margin-left: 8px;
        opacity: 0.5;
        font-size: 0.9rem;
      }

      .translation {
        display: block;
        font-size: 0.85rem;
        color: #7f8c8d;
        margin-top: 5px;
        font-style: italic;
        border-top: 1px solid rgba(0, 0, 0, 0.05);
        padding-top: 4px;
      }
    </style>
  </head>
  <body>
    <div class="chat-container">
      <div class="chat-header">
        <div class="d-flex align-items-center mb-3">
          <a href="conversation.html" class="btn btn-sm btn-light"
            >Conversation 1</a
          >
          <a href="conversation2.html" class="btn btn-sm btn-outline-light me-2"
            >Conversation 2</a
          >
        </div>
        <h3>üí¨ Le D√Æner (Roleplay)</h3>
        <div class="controls">
          <button class="mode-btn active" onclick="setMode('all')">
            üëÅÔ∏è Show All
          </button>
          <button class="mode-btn" onclick="setMode('hide-a')">
            üë§ I am B (Hide A)
          </button>
          <button class="mode-btn" onclick="setMode('hide-b')">
            üë§ I am A (Hide B)
          </button>
        </div>
        <div style="font-size: 0.8rem; margin-top: 5px; opacity: 0.8">
          Click any bubble to listen üîä
        </div>
      </div>

      <div class="chat-area" id="chat-box"></div>
    </div>

    <script>
      // The Data from our conversation
      const dialogue = [
        {
          speaker: "A",
          fr: "Allez, d√©p√™che-toi ! Ils arrivent dans cinq minutes.",
          en: "Come on, hurry up! They're arriving in five minutes.",
          audio: "media/con1.m4a",
        },
        {
          speaker: "B",
          fr: "√áa va, j'arrive ! T'as mis o√π les fourchettes ?",
          en: "Alright, I'm coming! Where did you put the forks?",
          audio: "media/con2.m4a",
        },
        {
          speaker: "A",
          fr: "Elles sont sur la table. Mais il manque les couteaux.",
          en: "They are on the table. But the knives are missing.",
          audio: "media/con3.m4a",
        },
        {
          speaker: "B",
          fr: "Je prends ceux √† steak ? La lame est bien aiguis√©e.",
          en: "Should I take the steak ones? The blade is very sharp.",
          audio: "media/con4.m4a",
        },
        {
          speaker: "A",
          fr: "Ouais, c'est mieux. Ah, et oublie pas : Julie mange avec des baguettes.",
          en: "Yeah, that's better. Oh, and don't forget: Julie eats with chopsticks.",
          audio: "media/con5.m4a",
        },
        {
          speaker: "B",
          fr: "S√©rieux ? OK. Et pour le dessert, je sors les grandes cuill√®res ?",
          en: "Seriously? OK. And for dessert, should I get the big spoons?",
          audio: "media/con6.m4a",
        },
        {
          speaker: "A",
          fr: "Non, les petites. Elles sont dans le tiroir du bas.",
          en: "No, the small ones. They are in the bottom drawer.",
          audio: "media/con7.m4a",
        },
      ];

      const chatBox = document.getElementById("chat-box");

      // 1. Render the Chat
      function renderChat() {
        chatBox.innerHTML = "";
        dialogue.forEach((line, index) => {
          const div = document.createElement("div");
          div.className = `message msg-${line.speaker.toLowerCase()}`;
          div.onclick = () => playAudio(index);

          // HTML Structure
          div.innerHTML = `
                <span class="speaker-label">Person ${line.speaker}</span>
                <span class="text-content">
                    ${line.fr} <span class="audio-icon">üîä</span>
                </span>
                <div class="translation">${line.en}</div>
                <audio id="audio-${index}" src="${line.audio}"></audio>
            `;

          // Add ID for blurring logic
          div.dataset.speaker = line.speaker;
          chatBox.appendChild(div);
        });
      }

      // 2. Roleplay Modes (Blurring)
      function setMode(mode) {
        // Reset buttons
        document
          .querySelectorAll(".mode-btn")
          .forEach((btn) => btn.classList.remove("active"));
        event.target.classList.add("active");

        // Logic
        const messages = document.querySelectorAll(".message");
        messages.forEach((msg) => {
          const textSpan = msg.querySelector(".text-content");

          // Reset blur
          textSpan.classList.remove("blur-me");

          // Apply blur based on mode
          if (mode === "hide-a" && msg.dataset.speaker === "A") {
            textSpan.classList.add("blur-me");
          } else if (mode === "hide-b" && msg.dataset.speaker === "B") {
            textSpan.classList.add("blur-me");
          }
        });
      }

      // 3. Audio Engine (Custom Audio Files)
      function playAudio(index) {
        // Stop any currently playing audio
        document.querySelectorAll("audio").forEach((a) => {
          a.pause();
          a.currentTime = 0;
        });

        // Play the selected one
        const audio = document.getElementById(`audio-${index}`);
        if (audio) audio.play();
      }

      // Init
      renderChat();
    </script>
    <script type="module" src="../../../../assets/js/nav-utensils.js"></script>
  </body>
</html>
