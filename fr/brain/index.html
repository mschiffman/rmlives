<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Brain and Language</title>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-CHXHM9CZKM"
    ></script>

    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-CHXHM9CZKM");
    </script>

    <!-- Favicons -->
    <link href="/img/favicon.png" rel="icon" />

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
        background: #1e1e1e;
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        overflow: hidden;
      }

      #graph {
        width: 100vw;
        height: 100vh;
      }

      .node {
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .node circle {
        stroke: none;
        transition: all 0.3s ease;
      }

      .node.main-node circle {
        stroke: none;
      }

      .node text {
        fill: #e0e0e0;
        font-size: 12px;
        text-anchor: middle;
        pointer-events: none;
        user-select: none;
        paint-order: stroke;
        stroke: #1e1e1e;
        stroke-width: 1px;
        stroke-linejoin: round;
      }

      .node.highlighted circle {
        fill: #007bff;
        filter: drop-shadow(0 0 8px #007bff);
      }

      .node.highlighted text {
        fill: #ffffff;
      }

      .node.dimmed circle {
        fill: #2a2a2a;
        stroke: #3a3a3a;
        opacity: 0.3;
      }

      .node.dimmed text {
        opacity: 0.3;
      }

      .link {
        stroke: #4a4a4a;
        stroke-width: 1px;
        stroke-opacity: 0.6;
        transition: all 0.3s ease;
      }

      .link.highlighted {
        stroke: #007bff;
        stroke-opacity: 1;
        filter: drop-shadow(0 0 4px #007bff);
      }

      .link.dimmed {
        stroke: #2a2a2a;
        stroke-opacity: 0.2;
      }

      .info-panel {
        position: absolute;
        top: 20px;
        left: 20px;
        background: rgba(40, 40, 40, 0.9);
        padding: 15px 20px;
        border-radius: 8px;
        color: #e0e0e0;
        font-size: 14px;
        border: 1px solid #4a4a4a;
        max-width: 300px;
      }

      .info-panel h3 {
        margin: 0 0 10px 0;
        color: #8b5cf6;
        font-size: 16px;
      }

      #legend {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 10px;
      }

      .legend-item {
        display: flex;
        align-items: center;
        cursor: pointer;
        font-size: 12px;
        color: #e0e0e0;
      }

      .legend-circle {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin-right: 5px;
        border: 2px solid;
      }

      .info-panel p {
        margin: 5px 0;
        line-height: 1.5;
      }

      .info-panel .shortcut {
        color: #a78bfa;
        font-weight: bold;
      }

      .hidden {
        display: none !important;
      }

      .controls {
        display: flex;
        gap: 10px;
        margin: 10px 0;
      }

      .control-btn {
        background: #333;
        border: 1px solid #555;
        color: #e0e0e0;
        padding: 4px 8px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 11px;
        text-decoration: none;
        text-align: center;
      }

      .control-btn:hover {
        background: #444;
        border-color: #8b5cf6;
      }

      /* Modal Styles */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(3px);
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background-color: #2a2a2a;
        padding: 30px;
        border-radius: 12px;
        border: 1px solid #4a4a4a;
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
        max-width: 600px;
        width: auto; /* Adapts to content */
        min-width: 300px;
        position: relative;
        color: #e0e0e0;
        animation: modalFadeIn 0.3s ease-out;
      }

      @keyframes modalFadeIn {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .close-button {
        position: absolute;
        top: 10px;
        right: 15px;
        color: #8b5cf6;
        font-size: 24px;
        font-weight: bold;
        cursor: pointer;
        transition: color 0.2s;
      }

      .close-button:hover {
        color: #fff;
      }

      #modalTitle {
        margin-top: 0;
        color: #8b5cf6;
        border-bottom: 1px solid #4a4a4a;
        padding-bottom: 10px;
        margin-bottom: 15px;
      }

      #modalBody {
        line-height: 1.6;
        margin-bottom: 20px;
        max-height: 60vh;
        overflow-y: auto;
        padding-right: 10px;
      }

      .modal-link-btn {
        display: inline-block;
        background-color: #007bff;
        color: white;
        padding: 8px 16px;
        border-radius: 4px;
        text-decoration: none;
        transition: background-color 0.2s;
      }

      .modal-link-btn:hover {
        background-color: #0056b3;
      }
    </style>
  </head>
  <body>
    <div class="info-panel">
      <h3>Nodes</h3>
      <p>
        Click a cluster to show/hide related pages from the network. Click on a
        node to go to the web page.
      </p>
      <div class="controls">
        <button id="check-all" class="control-btn">Check all</button>
        <button id="uncheck-all" class="control-btn">Uncheck all</button>
        <a href="../../sitemap.html" class="control-btn">Back to Site Map</a>
      </div>
      <div id="legend"></div>
    </div>

    <!-- Node Info Modal -->
    <div id="nodeModal" class="modal">
      <div class="modal-content">
        <span class="close-button">&times;</span>
        <h2 id="modalTitle"></h2>
        <div id="modalBody"></div>
        <a id="modalLink" href="#" target="_blank" class="modal-link-btn"
          >Visit Page</a
        >
      </div>
    </div>
    <svg id="graph"></svg>

    <script>
      // Graph data structure
      const graphData = {
        nodes: [
          // Main nodes
          {
            id: "Brain",
            group: 0,
            level: 0,
            url: "brainPic.html",
            description:
              "The brain is a dynamic organ that continuously reorganizes itself through the expansion of neural networks and the purging of weak synapses. Knowledge of these biological processes is essential for optimizing adult learning strategies.<br><br>Understanding the brain's 'operating system'\u2014how it stores, processes, and maintains information\u2014helps learners move past brute-force memorization and work with their biology rather than against it.<br><br>1. <b>Storage</b>: The Adult 'Hardware' Difference<br><br>Unlike children, who naturally absorb grammar through implicit 'procedural' memory, adults largely rely on 'declarative' memory\u2014the explicit system used for facts and vocabulary. This means adults often get stuck trying to 'memorize' grammar rules rather than internalizing them.<br><ul><li><b>The Strategy:</b> Acknowledge this biological reality by starting with explicit 'classroom-style' explanations to satisfy the declarative system, but immediately follow up with immersion-style practice. This transition is necessary to shift processing from the conscious temporal lobe to the automatic, native-like patterns found in the procedural system.</li></ul>2. Processing: Encoding through Association<br><br>The brain processes information better when it is multimodal rather than abstract text. 'Embodied learning'\u2014such as acting out a verb physically while saying it\u2014creates a stronger memory trace by linking motor neurons to language centers.<br><ul><li><b>The Strategy:</b> Avoid isolated lists. Use 'interleaving' (mixing different topics or languages) to create 'discriminative contrast,' which helps the brain distinguish between similar concepts.</li></ul>3. Cleaning & Maintenance: Pruning and Sleep<br><br>The brain has a 'cleanup' function called <b>synaptic pruning</b>, where it systematically eliminates weak or seldom-used connections to improve efficiency. If you don't use a pathway, the brain views it as 'noise' and removes it.<br><ul><li><b>The Strategy:</b> You must signal to the brain that this information is not noise. This is done through <b>Spaced Repetition</b> (revisiting info just before you forget it) and prioritizing <b>Sleep</b>. Sleep is not just rest; it actively blocks forgetting and 'replays' new information, transferring it from temporary storage to the neocortex for long-term retention. Without sleep, the day's learning is often purged.</li></ul>",
          },
          {
            id: "neural plasticity",
            group: 0,
            level: 1,
            description:
              "The brain's capacity to alter its structure, function, and connections in response to environmental stimuli, learning, experience, injury, or disease.",
          },
          {
            id: "synaptic pruning",
            group: 0,
            level: 1,
            description:
              "Synaptic pruning is the systematic elimination of excess, weak, or seldom-used synapses to increase the efficiency of neuronal signaling.",
          },
          {
            id: "Environment",
            group: 0,
            level: 1,
            description:
              "Environmental factors such as sleep, exercise, stress, and diet have a positive or negative impact on the brain.",
          },
          {
            id: "Sleep",
            group: 0,
            level: 2,
            description:
              "Sleep blocks forgetting, and replays newly acquired information, transferring it to the neocortex for long-term storage.",
          },
          {
            id: "Diet",
            group: 0,
            level: 2,
            description:
              "Diet plays a fundamental role in brain health by modulating neuroplasticity, supporting cognitive development, and influencing the risk of neurodegenerative diseases. Nutrition impacts the brain from the prenatal stage through aging, affecting the structural and functional integrity of neural networks.",
          },
          {
            id: "Exercise",
            group: 0,
            level: 2,
            description:
              "Exercise is a robust, non-invasive strategy for promoting neuroplasticity, the brain's ability to reorganize itself. It physically alters the brain's structure and chemical environment in ways that are conducive to learning.",
          },
          {
            id: "Stress",
            group: 0,
            level: 2,
            description:
              "While moderate arousal can aid encoding, acute stress (and the resulting cortisol release) significantly impairs the retrieval of memory. Adult learning environments should aim to reduce high-stakes anxiety during testing or speaking phases to ensure access to stored knowledge.",
          },
          {
            id: "Models",
            group: 1,
            level: 0,
            description:
              "Language acquisition relies on two primary memory systems:<br>1. declarative memory (for the mental lexicon/vocabulary)<br>2. procedural memory (for grammar/rules)",
          },
          {
            id: "Declarative",
            group: 1,
            level: 1,
            description:
              "<ul><li>Explicit learning (the 'classroom' approach) handles word knowledge.</li><li>Start Explicit, Then Proceduralize: Unlike children, adults rely on the declarative memory system (temporal lobe) to learn both vocabulary and grammar. Effective adult instruction often begins with explicit explanations (declarative) and moves toward implicit competence through practice. While explicit training provides initial understanding, implicit training (immersion-like conditions without metalinguistic explanations) is required to eventually achieve 'native-like' brain activation patterns (such as the AN+P600 ERP response).</li><li>Primarily involves the medial temporal lobe (hippocampus).</li></ul>",
          },
          {
            id: "Vocabulary",
            group: 1,
            level: 2,
            description:
              "When learning vocabulary, adults benefit from interleaving (mixing different topics or languages) rather than blocking (studying one topic exhaustively). For example, studying two languages (e.g., German and Polish) in a mixed session is more effective for retention than studying them separately. Interleaving creates 'discriminative contrast', helping the brain distinguish between similar concepts.",
          },
          {
            id: "Procedural",
            group: 1,
            level: 1,
            description:
              "<ul><li>Implicit learning (the 'immersion' approach) handles the unconscious rules of grammar, impacting language acquisition, processing, and disorders.</li><li>Involves network including frontal cortex, basal ganglia, cerebellum, and parietal cortex.</li></ul>",
          },
          {
            id: "Grammar",
            group: 1,
            level: 2,
            description:
              "<ul><li>When the goal is to discover or understand a grammatical rule, blocked practice (focusing on one category or pattern at a time) is more effective for adults. Seeing multiple examples of a single rule in succession helps adults abstract the underlying pattern.</li><li>Though children learn grammar rules implicitly, adults face reduced neuroplasticity and a crystallized first-language system, often forcing them to rely on declarative memory (explicit knowledge) rather than the procedural system used by children.</li></ul>",
          },
          {
            id: "Enrichment",
            group: 2,
            level: 0,
            description:
              "Mental engagement through learning and specific study strategies acts as exercise for the brain, stimulating neural networks and enhancing cognitive reserve.",
          },
          {
            id: "Social interactions",
            group: 2,
            level: 1,
            description:
              "Social engagement is considered a specific form of environmental enrichment. Positive social interactions and contact can modulate neuroplasticity and promote life-long stress resilience. If a human partner is unavailable, use AI language tutors. Unlike passive input, AI systems can act as conversational partners that require the learner to produce output, thereby providing personalized, adaptive support and immediate feedback.",
          },
          {
            id: "Multisensory input",
            group: 2,
            level: 1,
            description:
              "'Multisensory learning' leverages cross-modal plasticity, where combining visual, auditory, and kinesthetic inputs strengthens connections between language and sensorimotor regions. 'Embodied learning', such as pairing action verbs with physical gestures (e.g., acting out 'push' while saying it), significantly boosts acquisition by linking sensorimotor brain regions to word representations.",
          },
          {
            id: "Web of associations",
            group: 2,
            level: 1,
            description:
              "<ul><li><b>The brain is not a filing cabinet</b> where you store isolated facts; it is a <b>web</b>, where the strength of a memory depends on how many threads (or associations) connect it to what you already know.</li><li>Memory associations, built through <a href='https://rmlives.com/fr/grammar/noun/utensils/fork.html' target='_blank'>collocation webs</a> and chunking (e.g., instead of 'furchette', learn 'la fourchette propre'), are far more effective than learning single words in isolation. They create stronger memory associations.</li></ul>",
          },
          {
            id: "Feynman's Technique",
            group: 2,
            level: 1,
            description:
              "1. Choose a concept<br>2. Teach it to a Child<br>3. Identify Gaps & Review<br>4. Simplify & Use Analogies<br><ul><li>to connect the new concept to something familiar</li><li>e.g., Synaptic pruning is like a gardener cleaning a dense garden, removing weak or tangling vines to ensure the strongest plants get enough sunlight and resources to thrive.</li></ul>",
          },
          {
            id: "Cornell Note-Taking",
            group: 2,
            level: 1,
            url: "cornell.html",
            description:
              "A method that divides paper into sections for notes, questions/keywords, and summaries to promote active retrieval.",
          },
          {
            id: "Immediate Application",
            group: 2,
            level: 1,
            description:
              "There are several effective methods for applying new language knowledge immediately to boost retention. Immediate application triggers 'neuroplasticity'\u2014the brain's ability to rewire itself. Passive exposure (reading or listening) primarily engages the left hemisphere's language regions. However, 'active production' (speaking or writing) recruits a broader neural network, including right-hemisphere frontal and temporal regions involved in motor planning and cognitive monitoring. Furthermore, methods that involve novelty and active engagement trigger the release of 'dopamine', a neurotransmitter associated with reward, which physically strengthens the retention of new information.",
          },
          {
            id: "Spaced repetition",
            group: 2,
            level: 1,
            description:
              "A powerful memory technique that involves reviewing new vocabulary and grammar at gradually increasing time intervals, moving information from short-term to long-term memory by strategically spacing out study sessions, showing difficult items more often and mastered items less often to combat the 'forgetting curve'. It's a core part of apps like Anki and Duolingo.",
          },
          {
            id: "Active recall",
            group: 2,
            level: 1,
            description:
              "Active recall (retrieving information from memory rather than passively reviewing it) strengthens brain connections and long-term memory. It forces the brain to reconstruct memories, making them more durable than memories formed through passive reading.",
          },
          {
            id: "Quizzes",
            group: 2,
            level: 2,
            description:
              "Active recall is different from simple recognition. Multiple-choice tests can sometimes give a false sense of knowledge because the answer is visible. True active recall requires constructing an answer from scratch without cues.",
          },
          {
            id: "Flashcards",
            group: 2,
            level: 2,
            description:
              "Apps like <b>Anki</b>, <b>Quizlet</b>, or <b>>Brainscape</b>, can create digital cards which automate spacing/frequency based on your confidence level.",
          },
          {
            id: "Understand 'why'",
            group: 2,
            level: 1,
            description:
              'The brain struggles to hold onto isolated pieces of data (rote memorization). When you understand the "why"\u2014the underlying logic, cause, or mechanism\u2014you are engaging in what psychologists call \'deep processing\'.<br><br>The actual effort it takes to figure out the "why" signals your hippocampus (the brain\'s memory center) that this information is important.<br><ul><li>Passively reading a fact is low-effort and low-retention.</li><li>Actively wrestling with a concept to understand its origin or mechanism requires focus. This "desirable difficulty" cements the memory.</li></ul>',
          },
          {
            id: "Generative Questioning",
            group: 2,
            level: 1,
            description:
              "Instead of multiple-choice tests (which rely on recognition), answer open-ended questions like \u201cHow does resin transform into amber?\u201d in the target language.",
          },
          {
            id: "Summaries",
            group: 2,
            level: 1,
            description:
              "Read a text in the target language and then summarize the plot or main ideas in your own words without looking at the text. For example, for the reading material on <a href='https://rmlives.com/fr/reading/amber.html' target='_blank'>amber</a>, the summary would be (L’ambre est de la résine d’arbre fossilisée, pas des gouttes de soleil comme le croyaient les Grecs. La résine coule pour guérir l’arbre, piège parfois des insectes, et durcit sur des millions d’années. C’est une capsule temporelle précieuse du passé. Il existe un type rare qui change de couleur au soleil.)",
          },
          {
            id: "Mind Mapping",
            group: 2,
            level: 1,
            url: "https://rmlives.com/fr/enunciation/me-consonant.html",
            description:
              "Create diagrams or mind maps from memory to organize and link new vocabulary or grammar concepts visually. Click on 'Go to Page' to see an example of a mind map.",
          },
        ],
        links: [
          {
            source: "Brain",
            target: "neural plasticity",
          },
          {
            source: "Brain",
            target: "synaptic pruning",
          },
          {
            source: "Brain",
            target: "Environment",
          },
          {
            source: "Environment",
            target: "Sleep",
          },
          {
            source: "Environment",
            target: "Diet",
          },
          {
            source: "Environment",
            target: "Exercise",
          },
          {
            source: "Environment",
            target: "Stress",
          },
          {
            source: "Models",
            target: "Declarative",
          },
          {
            source: "Declarative",
            target: "Vocabulary",
          },
          {
            source: "Models",
            target: "Procedural",
          },
          {
            source: "Procedural",
            target: "Grammar",
          },
          {
            source: "Enrichment",
            target: "Social interactions",
          },
          {
            source: "Enrichment",
            target: "Multisensory input",
          },
          {
            source: "Enrichment",
            target: "Web of associations",
          },
          {
            source: "Enrichment",
            target: "Feynman's Technique",
          },
          {
            source: "Enrichment",
            target: "Cornell Note-Taking",
          },
          {
            source: "Enrichment",
            target: "Immediate Application",
          },
          {
            source: "Enrichment",
            target: "Spaced repetition",
          },
          {
            source: "Enrichment",
            target: "Active recall",
          },
          {
            source: "Active recall",
            target: "Quizzes",
          },
          {
            source: "Active recall",
            target: "Flashcards",
          },
          {
            source: "Enrichment",
            target: "Understand 'why'",
          },
          {
            source: "Enrichment",
            target: "Generative Questioning",
          },
          {
            source: "Enrichment",
            target: "Summaries",
          },
          {
            source: "Enrichment",
            target: "Mind Mapping",
          },
        ],
      };

      // Modal Logic
      const modal = document.getElementById("nodeModal");
      const closeBtn = document.querySelector(".close-button");
      const modalTitle = document.getElementById("modalTitle");
      const modalBody = document.getElementById("modalBody");
      const modalLink = document.getElementById("modalLink");

      function openModal(d) {
        modalTitle.textContent = d.id;
        // Use description if available in data, otherwise generic text
        modalBody.innerHTML =
          d.description ||
          `This is the node for "${d.id}". It is part of the ${d.group} group.`;

        if (d.url) {
          modalLink.href = d.url;
          modalLink.style.display = "inline-block";
          modalLink.textContent = "Go to Page";
        } else {
          modalLink.style.display = "none";
        }

        modal.style.display = "flex";
      }

      closeBtn.onclick = () => (modal.style.display = "none");
      window.onclick = (event) => {
        if (event.target === modal) modal.style.display = "none";
      };

      // Set up SVG
      const width = window.innerWidth;
      const height = window.innerHeight;

      const svg = d3
        .select("#graph")
        .attr("width", width)
        .attr("height", height);

      // Create zoom behavior
      const g = svg.append("g");

      const zoom = d3
        .zoom()
        .scaleExtent([0.1, 4])
        .on("zoom", (event) => {
          g.attr("transform", event.transform);

          const k = event.transform.k;
          const fontSize = k * 12 > 14.2 ? 14.2 / k : 12;
          g.selectAll(".node text").style("font-size", fontSize + "px");
        });

      svg.call(zoom);

      // Create force simulation
      const simulation = d3
        .forceSimulation(graphData.nodes)
        .force(
          "link",
          d3
            .forceLink(graphData.links)
            .id((d) => d.id)
            .distance(80),
        )
        .force("charge", d3.forceManyBody().strength(-120))
        .force("center", d3.forceCenter(width / 2, height / 2))
        .force("x", d3.forceX(width / 2).strength(0.08))
        .force("y", d3.forceY(height / 2).strength(0.08))
        .force("collision", d3.forceCollide().radius(20));

      // Create links
      const link = g
        .append("g")
        .selectAll("line")
        .data(graphData.links)
        .enter()
        .append("line")
        .attr("class", "link");

      // Create nodes
      const node = g
        .append("g")
        .selectAll("g")
        .data(graphData.nodes)
        .enter()
        .append("g")
        .attr("class", (d) => (d.level === 0 ? "node main-node" : "node"))
        .call(
          d3
            .drag()
            .on("start", dragstarted)
            .on("drag", dragged)
            .on("end", dragended),
        );

      // Color scale
      const color = d3.scaleOrdinal(d3.schemeCategory10);

      // Add circles to nodes
      node
        .append("circle")
        .attr("r", (d) => (d.level === 0 ? 12 : d.level === 1 ? 8 : 6))
        .attr("fill", (d) => color(d.group));

      // Legend Logic
      const legendContainer = d3.select("#legend");
      const hiddenGroups = new Set();

      // Get unique groups and their labels (level 0 node id)
      const groups = [...new Set(graphData.nodes.map((d) => d.group))].sort();
      const groupLabels = {};
      graphData.nodes.forEach((n) => {
        if (n.level === 0) groupLabels[n.group] = n.id;
      });

      groups.forEach((groupId) => {
        const colorVal = color(groupId);
        const item = legendContainer
          .append("div")
          .attr("class", "legend-item")
          .on("click", () => toggleGroup(groupId));

        item
          .append("div")
          .attr("class", "legend-circle")
          .style("background-color", colorVal)
          .style("border-color", colorVal)
          .attr("data-group", groupId);

        item.append("span").text(groupLabels[groupId] || `Group ${groupId}`);
      });

      d3.select("#check-all").on("click", () => {
        hiddenGroups.clear();
        updateVisibility();
        updateLegendUI();
      });

      d3.select("#uncheck-all").on("click", () => {
        groups.forEach((g) => hiddenGroups.add(g));
        updateVisibility();
        updateLegendUI();
      });

      function toggleGroup(groupId) {
        if (hiddenGroups.has(groupId)) {
          hiddenGroups.delete(groupId);
        } else {
          hiddenGroups.add(groupId);
        }
        updateVisibility();
        updateLegendUI();
      }

      function updateLegendUI() {
        d3.selectAll(".legend-circle").each(function () {
          const el = d3.select(this);
          const gId = +el.attr("data-group");
          const colorVal = color(gId);
          el.style(
            "background-color",
            hiddenGroups.has(gId) ? "transparent" : colorVal,
          );
        });
      }

      function updateVisibility() {
        node.classed("hidden", (d) => hiddenGroups.has(d.group));
        link.classed(
          "hidden",
          (d) =>
            hiddenGroups.has(d.source.group) ||
            hiddenGroups.has(d.target.group),
        );
      }

      // Add labels to nodes
      node
        .append("text")
        .attr("dy", (d) => (d.level === 0 ? -18 : -14))
        .text((d) => d.id);

      // Hover handling
      node
        .on("mouseover", function (event, d) {
          highlightNode(d);
        })
        .on("mouseout", function () {
          clearHighlight();
        })
        .on("click", function (event, d) {
          event.stopPropagation();
          openModal(d);
        });

      function highlightNode(selectedNode) {
        // Find all connected nodes
        const connectedNodes = new Set([selectedNode.id]);
        const connectedLinks = new Set();

        // Get descendants (children and grandchildren)
        function addDescendants(nodeId) {
          graphData.links.forEach((link) => {
            const sourceId =
              typeof link.source === "object" ? link.source.id : link.source;
            const targetId =
              typeof link.target === "object" ? link.target.id : link.target;

            if (sourceId === nodeId) {
              connectedNodes.add(targetId);
              connectedLinks.add(link);
              addDescendants(targetId);
            }
          });
        }

        addDescendants(selectedNode.id);

        // Update nodes
        node
          .classed("highlighted", (d) => connectedNodes.has(d.id))
          .classed("dimmed", (d) => !connectedNodes.has(d.id));

        // Update links
        link
          .classed("highlighted", (d) => connectedLinks.has(d))
          .classed("dimmed", (d) => !connectedLinks.has(d));
      }

      function clearHighlight() {
        node.classed("highlighted", false).classed("dimmed", false);
        link.classed("highlighted", false).classed("dimmed", false);
      }

      // Update positions on simulation tick
      simulation.on("tick", () => {
        link
          .attr("x1", (d) => d.source.x)
          .attr("y1", (d) => d.source.y)
          .attr("x2", (d) => d.target.x)
          .attr("y2", (d) => d.target.y);

        node.attr("transform", (d) => `translate(${d.x},${d.y})`);
      });

      // Drag functions
      function dragstarted(event, d) {
        if (!event.active) simulation.alphaTarget(0.3).restart();
        d.fx = d.x;
        d.fy = d.y;
      }

      function dragged(event, d) {
        d.fx = event.x;
        d.fy = event.y;
      }

      function dragended(event, d) {
        if (!event.active) simulation.alphaTarget(0);
        d.fx = null;
        d.fy = null;
      }

      // Handle window resize
      window.addEventListener("resize", () => {
        const newWidth = window.innerWidth;
        const newHeight = window.innerHeight;
        svg.attr("width", newWidth).attr("height", newHeight);
        simulation.force("center", d3.forceCenter(newWidth / 2, newHeight / 2));
        simulation.force("x", d3.forceX(newWidth / 2).strength(0.08));
        simulation.force("y", d3.forceY(newHeight / 2).strength(0.08));
        simulation.alpha(0.3).restart();
      });
    </script>
  </body>
</html>
