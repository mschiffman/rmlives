<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Cloze Test: Au March√©</title>

    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-CHXHM9CZKM"
    ></script>

    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-CHXHM9CZKM");
    </script>

    <!-- Favicons -->
    <link href="/img/favicon.png" rel="icon" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <link rel="stylesheet" href="../../assets/css/cloze.css" />
  </head>
  <body>
    <div class="quiz-container">
      <h2>üõí Au March√© ! (Quiz)</h2>
      <p class="text-center text-muted mb-4">
        Fill in the missing noun, verb, or adjective.
      </p>

      <div id="quiz-form">
        <div class="sentence-item">
          1. Le samedi matin, je vais faire le
          <input type="text" class="cloze-input" data-answer="march√©" />
          pour acheter des produits frais.
        </div>

        <div class="sentence-item">
          2. Le
          <input type="text" class="cloze-input" data-answer="vendeur" />
          de l√©gumes me conseille toujours les meilleurs produits.
        </div>

        <div class="sentence-item">
          3. J'ach√®te des tomates
          <input type="text" class="cloze-input" data-answer="fra√Æches" />
          pour ma salade.
        </div>

        <div class="sentence-item">
          4. Pour porter mes courses, j'apporte un
          <input type="text" class="cloze-input" data-answer="panier" />.
        </div>

        <div class="sentence-item">
          5. Les fruits sont tr√®s
          <input type="text" class="cloze-input" data-answer="m√ªrs" />
          aujourd'hui, parfaits pour manger tout de suite.
        </div>

        <div class="sentence-item">
          6. Je prends une
          <input type="text" class="cloze-input" data-answer="baguette" />
          de pain pour le d√Æner.
        </div>

        <div class="sentence-item">
          7. Le fromage est
          <input type="text" class="cloze-input" data-answer="artisanal" />,
          fait √† la ferme.
        </div>

        <div class="sentence-item">
          8. Les produits
          <input type="text" class="cloze-input" data-answer="bio" />
          sont un peu plus chers mais meilleurs pour la sant√©.
        </div>

        <div class="sentence-item">
          9. Je demande au vendeur : "Combien √ßa
          <input type="text" class="cloze-input" data-answer="co√ªte" />
          ?"
        </div>

        <div class="sentence-item">
          10. Le vendeur utilise une
          <input type="text" class="cloze-input" data-answer="balance" />
          pour peser les l√©gumes.
        </div>

        <div class="sentence-item">
          11. Les herbes
          <input type="text" class="cloze-input" data-answer="fra√Æches" />
          sentent tr√®s bon.
        </div>

        <div class="sentence-item">
          12. Je cherche des produits
          <input type="text" class="cloze-input" data-answer="locaux" />
          de la r√©gion.
        </div>
      </div>

      <div class="btn-container">
        <button class="btn btn-success" onclick="checkAnswers()">
          Check Answers
        </button>
        <button class="btn btn-secondary" onclick="resetQuiz()">Reset</button>
      </div>

      <div
        id="score-display"
        style="
          text-align: center;
          margin-top: 20px;
          font-weight: bold;
          color: #2c3e50;
        "
      ></div>
    </div>

    <script>
      function checkAnswers() {
        const inputs = document.querySelectorAll(".cloze-input");
        let correctCount = 0;

        inputs.forEach((input) => {
          const userAnswer = input.value.trim().toLowerCase();
          const correctAnswer = input.getAttribute("data-answer").toLowerCase();

          // Handle accent forgiveness (fra√Æches vs fraiches, etc.)
          const cleanUser = userAnswer
            .normalize("NFD")
            .replace(/[\u0300-\u036f]/g, "");
          const cleanCorrect = correctAnswer
            .normalize("NFD")
            .replace(/[\u0300-\u036f]/g, "");

          // Remove existing feedback if any
          const parent = input.parentNode;
          const existingFeedback = parent.querySelector(".correction-feedback");
          if (existingFeedback) {
            existingFeedback.remove();
          }

          if (cleanUser === cleanCorrect) {
            input.classList.add("correct");
            input.classList.remove("wrong");
            correctCount++;
          } else {
            input.classList.add("wrong");
            input.classList.remove("correct");

            // Show correct answer at end of sentence
            const feedback = document.createElement("span");
            feedback.className = "correction-feedback";
            feedback.style.color = "#27ae60";
            feedback.style.fontWeight = "bold";
            feedback.style.marginLeft = "6px";
            feedback.innerText = `[${input.getAttribute("data-answer")}]`;
            parent.appendChild(feedback);
          }
        });

        const scoreDiv = document.getElementById("score-display");
        if (correctCount === inputs.length) {
          scoreDiv.innerHTML = "üéâ Excellent! 12/12 Correct.";
          scoreDiv.style.color = "#27ae60";
        } else {
          scoreDiv.innerHTML = `Score: ${correctCount} / ${inputs.length}`;
          scoreDiv.style.color = "#c0392b";
        }
      }

      function resetQuiz() {
        const inputs = document.querySelectorAll(".cloze-input");
        inputs.forEach((input) => {
          input.value = "";
          input.classList.remove("correct", "wrong");

          // Remove feedback
          const parent = input.parentNode;
          const existingFeedback = parent.querySelector(".correction-feedback");
          if (existingFeedback) {
            existingFeedback.remove();
          }
        });
        document.getElementById("score-display").innerHTML = "";
      }
    </script>
    <script type="module" src="../../assets/js/nav-utensils.js"></script>
  </body>
</html>
