<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Défi Mémoire : Le Marché (B1)</title>

    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-CHXHM9CZKM"
    ></script>

    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-CHXHM9CZKM");
    </script>

    <!-- Favicons -->
    <link href="/img/favicon.png" rel="icon" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --timer-color: #0d6efd;
      }
      body {
        background-color: #f8f9fa;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }
      .challenge-container {
        max-width: 800px;
        margin: 50px auto;
      }

      #marketImage {
        width: 100%;
        border-radius: 15px;
        transition: filter 0.5s ease;
      }

      .img-hidden {
        filter: blur(20px) grayscale(100%);
        pointer-events: none;
      }

      .img-dimmed {
        filter: brightness(0.3) blur(5px);
      }

      .timer-display {
        font-size: 2.5rem;
        font-weight: bold;
        color: var(--timer-color);
      }

      .question-card {
        display: none;
      }

      .feedback-area {
        border-left: 4px solid #198754;
        display: none;
      }

      .question-label {
        font-weight: bold;
        color: #495057;
      }

      .score-display {
        font-size: 1.5rem;
        font-weight: bold;
        color: #198754;
      }

      .answer-feedback {
        display: none;
        margin-top: 8px;
        padding: 10px;
        background-color: #d1e7dd;
        border-left: 4px solid #198754;
        border-radius: 4px;
        font-size: 0.95rem;
      }

      .btn-hint {
        background-color: #6c757d;
        border-color: #6c757d;
        color: white;
      }

      .btn-hint:hover {
        background-color: #5a6268;
        border-color: #545b62;
        color: white;
      }
    </style>
  </head>
  <body>
    <div class="container challenge-container">
      <div class="card shadow border-0 overflow-hidden">
        <div
          class="card-header bg-white py-3 d-flex justify-content-between align-items-center"
        >
          <h4 class="mb-0 text-primary">⏱️ Défi Mémoire : Le Marché (B1)</h4>
          <div class="d-flex align-items-center">
            <button
              class="btn btn-outline-danger me-3"
              onclick="skipToQuestions()"
            >
              Passer aux questions
            </button>
            <div id="timer" class="timer-display">30</div>
          </div>
        </div>

        <div class="card-body p-0 position-relative">
          <img
            src="/img/everyday/marche.jpg"
            id="marketImage"
            alt="Marché en plein air"
            class="img-fluid img-dimmed"
          />

          <div
            id="timeUpOverlay"
            class="position-absolute top-50 start-50 translate-middle text-center d-none"
          >
            <h2 class="display-4 fw-bold text-dark">TEMPS ÉCOULÉ !</h2>
            <p class="lead">Répondez aux 10 questions sans regarder l'image.</p>
          </div>
        </div>

        <div class="card-body p-4">
          <div id="startSection" class="text-center">
            <p class="lead">
              Vous avez 30 secondes pour mémoriser les détails de l'image du
              marché.
            </p>
            <p class="text-muted">
              Observez bien les personnes, les produits, les couleurs et les
              positions.
            </p>
            <button
              class="btn btn-primary btn-lg px-5"
              onclick="startChallenge()"
            >
              Commencer le Défi
            </button>
          </div>

          <div id="questionSection" class="question-card">
            <h5 class="mb-4">
              Répondez aux questions sur ce que vous avez vu :
            </h5>

            <div class="mb-3">
              <label class="form-label question-label"
                >1. Que tient le garçon au milieu de l'image ?</label
              >
              <div class="input-group">
                <input
                  type="text"
                  class="form-control"
                  id="q1"
                  placeholder="Votre réponse..."
                  spellcheck="true"
                  lang="fr"
                />
                <button
                  class="btn btn-success"
                  type="button"
                  onclick="showAnswer(1)"
                >
                  <i class="bi bi-check-lg"></i>
                </button>
                <button
                  class="btn btn-hint"
                  type="button"
                  onclick="playHint(1)"
                >
                  <i class="bi bi-volume-up-fill"></i>
                </button>
              </div>
              <div class="answer-feedback" id="ans1">
                Le garçon tient une tranche de <strong>pastèque</strong>.
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label question-label"
                >2. De quelle couleur sont les auvents des stands ?</label
              >
              <div class="input-group">
                <input
                  type="text"
                  class="form-control"
                  id="q2"
                  placeholder="Votre réponse..."
                  spellcheck="true"
                  lang="fr"
                />
                <button
                  class="btn btn-success"
                  type="button"
                  onclick="showAnswer(2)"
                >
                  <i class="bi bi-check-lg"></i>
                </button>
                <button
                  class="btn btn-hint"
                  type="button"
                  onclick="playHint(2)"
                >
                  <i class="bi bi-volume-up-fill"></i>
                </button>
              </div>
              <div class="answer-feedback" id="ans2">
                Les auvents sont <strong>rouge et blanc</strong> (rayés).
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label question-label"
                >3. Combien y a-t-il de citrouilles sur l'étal de droite
                ?</label
              >
              <div class="input-group">
                <input
                  type="text"
                  class="form-control"
                  id="q3"
                  placeholder="Votre réponse..."
                  spellcheck="true"
                  lang="fr"
                />
                <button
                  class="btn btn-success"
                  type="button"
                  onclick="showAnswer(3)"
                >
                  <i class="bi bi-check-lg"></i>
                </button>
                <button
                  class="btn btn-hint"
                  type="button"
                  onclick="playHint(3)"
                >
                  <i class="bi bi-volume-up-fill"></i>
                </button>
              </div>
              <div class="answer-feedback" id="ans3">
                Il y a <strong>deux</strong> citrouilles sur l'étal.
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label question-label"
                >4. Que porte la vendeuse à gauche sur la tête ?</label
              >
              <div class="input-group">
                <input
                  type="text"
                  class="form-control"
                  id="q4"
                  placeholder="Votre réponse..."
                  spellcheck="true"
                  lang="fr"
                />
                <button
                  class="btn btn-success"
                  type="button"
                  onclick="showAnswer(4)"
                >
                  <i class="bi bi-check-lg"></i>
                </button>
                <button
                  class="btn btn-hint"
                  type="button"
                  onclick="playHint(4)"
                >
                  <i class="bi bi-volume-up-fill"></i>
                </button>
              </div>
              <div class="answer-feedback" id="ans4">
                La vendeuse porte une <strong>toque de chef</strong>.
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label question-label"
                >5. Quel fruit la dame âgée tient-elle dans sa main ?</label
              >
              <div class="input-group">
                <input
                  type="text"
                  class="form-control"
                  id="q5"
                  placeholder="Votre réponse..."
                  spellcheck="true"
                  lang="fr"
                />
                <button
                  class="btn btn-success"
                  type="button"
                  onclick="showAnswer(5)"
                >
                  <i class="bi bi-check-lg"></i>
                </button>
                <button
                  class="btn btn-hint"
                  type="button"
                  onclick="playHint(5)"
                >
                  <i class="bi bi-volume-up-fill"></i>
                </button>
              </div>
              <div class="answer-feedback" id="ans5">
                La dame âgée tient une <strong>banane</strong>.
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label question-label"
                >6. Quels légumes orange vend le vendeur à droite ?</label
              >
              <div class="input-group">
                <input
                  type="text"
                  class="form-control"
                  id="q6"
                  placeholder="Votre réponse..."
                  spellcheck="true"
                  lang="fr"
                />
                <button
                  class="btn btn-success"
                  type="button"
                  onclick="showAnswer(6)"
                >
                  <i class="bi bi-check-lg"></i>
                </button>
                <button
                  class="btn btn-hint"
                  type="button"
                  onclick="playHint(6)"
                >
                  <i class="bi bi-volume-up-fill"></i>
                </button>
              </div>
              <div class="answer-feedback" id="ans6">
                Le vendeur vend des <strong>carottes</strong> et du maïs.
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label question-label"
                >7. Que fait la petite fille devant les oranges ?</label
              >
              <div class="input-group">
                <input
                  type="text"
                  class="form-control"
                  id="q7"
                  placeholder="Votre réponse..."
                  spellcheck="true"
                  lang="fr"
                />
                <button
                  class="btn btn-success"
                  type="button"
                  onclick="showAnswer(7)"
                >
                  <i class="bi bi-check-lg"></i>
                </button>
                <button
                  class="btn btn-hint"
                  type="button"
                  onclick="playHint(7)"
                >
                  <i class="bi bi-volume-up-fill"></i>
                </button>
              </div>
              <div class="answer-feedback" id="ans7">
                La petite fille <strong>tend la main</strong> vers les oranges.
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label question-label"
                >8. Quel type de chapeau porte le vendeur à droite ?</label
              >
              <div class="input-group">
                <input
                  type="text"
                  class="form-control"
                  id="q8"
                  placeholder="Votre réponse..."
                  spellcheck="true"
                  lang="fr"
                />
                <button
                  class="btn btn-success"
                  type="button"
                  onclick="showAnswer(8)"
                >
                  <i class="bi bi-check-lg"></i>
                </button>
                <button
                  class="btn btn-hint"
                  type="button"
                  onclick="playHint(8)"
                >
                  <i class="bi bi-volume-up-fill"></i>
                </button>
              </div>
              <div class="answer-feedback" id="ans8">
                Le vendeur porte un <strong>chapeau de paille</strong>.
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label question-label"
                >9. Quels fruits jaunes sont accrochés en hauteur à gauche
                ?</label
              >
              <div class="input-group">
                <input
                  type="text"
                  class="form-control"
                  id="q9"
                  placeholder="Votre réponse..."
                  spellcheck="true"
                  lang="fr"
                />
                <button
                  class="btn btn-success"
                  type="button"
                  onclick="showAnswer(9)"
                >
                  <i class="bi bi-check-lg"></i>
                </button>
                <button
                  class="btn btn-hint"
                  type="button"
                  onclick="playHint(9)"
                >
                  <i class="bi bi-volume-up-fill"></i>
                </button>
              </div>
              <div class="answer-feedback" id="ans9">
                Ce sont des <strong>bananes</strong> accrochées en hauteur.
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label question-label"
                >10. De quelle couleur est le sweat du garçon qui tient la
                pastèque ?</label
              >
              <div class="input-group">
                <input
                  type="text"
                  class="form-control"
                  id="q10"
                  placeholder="Votre réponse..."
                  spellcheck="true"
                  lang="fr"
                />
                <button
                  class="btn btn-success"
                  type="button"
                  onclick="showAnswer(10)"
                >
                  <i class="bi bi-check-lg"></i>
                </button>
                <button
                  class="btn btn-hint"
                  type="button"
                  onclick="playHint(10)"
                >
                  <i class="bi bi-volume-up-fill"></i>
                </button>
              </div>
              <div class="answer-feedback" id="ans10">
                Le sweat du garçon est <strong>turquoise</strong>.
              </div>
            </div>

            <div class="text-center mt-5">
              <button class="btn btn-outline-secondary" onclick="revealImage()">
                <i class="bi bi-eye-fill"></i> Revoir l'image (sans minuterie)
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      let timeLeft = 30;
      let timerInterval;

      const audioPath = "/media/everyday/marche/memory/";

      function startChallenge() {
        document.getElementById("startSection").classList.add("d-none");
        document.getElementById("marketImage").classList.remove("img-dimmed");

        timerInterval = setInterval(() => {
          timeLeft--;
          document.getElementById("timer").innerText = timeLeft;

          if (timeLeft <= 10) {
            document.getElementById("timer").style.color = "#dc3545";
          }

          if (timeLeft <= 0) {
            endChallenge();
          }
        }, 1000);
      }

      function endChallenge() {
        clearInterval(timerInterval);
        document.getElementById("marketImage").classList.add("img-hidden");
        document.getElementById("timeUpOverlay").classList.remove("d-none");
        document.getElementById("questionSection").style.display = "block";
        document.getElementById("timer").innerText = "0";
      }

      function showAnswer(num) {
        const el = document.getElementById("ans" + num);
        el.style.display = el.style.display === "block" ? "none" : "block";
      }

      function playHint(num) {
        const audio = new Audio(audioPath + num + ".mp3");
        audio.play();
      }

      function revealImage() {
        document.getElementById("marketImage").classList.remove("img-hidden");
        document.getElementById("timeUpOverlay").classList.add("d-none");
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      function skipToQuestions() {
        document.getElementById("startSection").classList.add("d-none");
        document.getElementById("marketImage").classList.remove("img-dimmed");
        endChallenge();
      }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
